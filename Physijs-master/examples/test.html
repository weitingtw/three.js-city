<!DOCTYPE html>

<html>

<head>
    <title>Collisions - Physijs</title>

    <link rel="stylesheet" type="text/css" href="css/styles.css" />

    <script type="text/javascript" src="js/three.min.js"></script>
    <script type="text/javascript" src="js/stats.js"></script>
    <script type="text/javascript" src="../physi.js"></script>

    <script type="text/javascript">

        'use strict';

        Physijs.scripts.worker = '../physijs_worker.js';
        Physijs.scripts.ammo = 'examples/js/ammo.js';

        var initScene, render, _boxes = [], spawnBox, loader,
            renderer, render_stats, physics_stats, scene, ground_material, ground, light, camera;

        initScene = function () {
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMapSoft = true;
            document.getElementById('viewport').appendChild(renderer.domElement);


            scene = new Physijs.Scene;
            scene.setGravity(new THREE.Vector3(0, -30, 0));
            scene.addEventListener(
                'update',
                function () {
                    scene.simulate(undefined, 1);
                    physics_stats.update();
                }
            );

            camera = new THREE.PerspectiveCamera(
                35,
                window.innerWidth / window.innerHeight,
                1,
                1000
            );
            camera.position.set(60, 50, 60);
            camera.lookAt(scene.position);
            scene.add(camera);

            // Light
            light = new THREE.DirectionalLight(0xFFFFFF);
            light.position.set(20, 40, -15);
            light.target.position.copy(scene.position);
            light.castShadow = true;
            light.shadowCameraLeft = -60;
            light.shadowCameraTop = -60;
            light.shadowCameraRight = 60;
            light.shadowCameraBottom = 60;
            light.shadowCameraNear = 20;
            light.shadowCameraFar = 200;
            light.shadowBias = -.0001
            light.shadowMapWidth = light.shadowMapHeight = 2048;
            light.shadowDarkness = .7;
            scene.add(light);

            // Loader
            loader = new THREE.TextureLoader();

            // Ground
            ground_material = Physijs.createMaterial(
                new THREE.MeshLambertMaterial({ color: 0xAAAAAA }),
                .8, // high friction
                .3 // low restitution
            );

            ground = new Physijs.BoxMesh(
                new THREE.BoxGeometry(100, 1, 100),
                ground_material,
                0 // mass
            );
            ground.receiveShadow = true;
            scene.add(ground);



            requestAnimationFrame(render);
            scene.simulate();
        };

        render = function () {
            requestAnimationFrame(render);
            renderer.render(scene, camera);
            render_stats.update();
        };

        window.onload = initScene;

    </script>
</head>

<body>
    <div id="heading">
        <h1>Collisions</h1>
        <p>Demonstrating the collision callback</p>
    </div>
    <div id="viewport"></div>
</body>

</html>